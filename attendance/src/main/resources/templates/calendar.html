<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar {
            width: 100%;
            max-width: 600px;
            margin: auto;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            margin-top: 20px;
        }

        .day-title {
            font-weight: bold;
            background: #f0f0f0;
            padding: 5px;
        }

        .day {
            padding: 10px;
            border: 1px solid #ccc;
            background: white;
        }

        .empty {
            background: #fafafa;
        }

        .highlight {
            background: yellow !important;
            font-weight: bold;
        }
    </style>
</head>

<body style="background-color: #9ca3af; color: #1b1b18;" class="min-h-screen">

<!-- Top Bar -->
<header class="fixed top-0 left-0 right-0 bg-gray-800 text-white flex justify-between items-center px-6 py-4 shadow-md z-40">
    <div class="flex items-center space-x-4">
        <!-- Sidebar Toggle Button -->
        <button id="openSidebar" class="bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded">
            â˜°
        </button>
        <h1 class="text-xl font-semibold">Calendar</h1>
    </div>

    <!-- Right side content (optional) -->
    <div class="flex items-center space-x-4">
        <span class="text-sm">Welcome, Yaana</span>
        <button class="bg-gray-500 hover:bg-gray-900 px-2 py-1 rounded">Logout</button>
    </div>
</header>

<!-- Sidebar -->
<aside id="sidebar"
       class="fixed left-0 top-0 h-full w-64 bg-gray-800 text-white transform -translate-x-full transition-transform duration-300 ease-in-out z-50">
    <div class="p-6 flex justify-between items-center border-b border-gray-700">
        <h2 class="text-xl font-semibold">Menu</h2>
        <button id="closeSidebar" class="text-white text-2xl">&times;</button>
    </div>
    <nav class="flex flex-col space-y-4 p-6">
        <a href="/dashboard" class="hover:bg-gray-700 p-2 rounded">Dashboard</a>
        <a href="/checkin" class="hover:bg-gray-700 p-2 rounded">Check In Attendance</a>
        <a href="/calendar" class="hover:bg-gray-700 p-2 rounded">Calendar</a>
    </nav>
</aside>

<!-- MAIN CONTENT WRAPPER -->
<div class="pt-24 px-4"> <!-- Adds margin so content drops below header -->

    <h2 id="title" class="text-2xl font-bold text-center mb-4"></h2>

    <!-- Search Bar -->
    <div id="dateSearchBar" class="flex justify-center space-x-2 mb-4">
        <input id="yearInput" type="number" placeholder="Year" class="border px-2 py-1 w-24">
        <input id="monthInput" type="number" placeholder="Month" class="border px-2 py-1 w-24">
        <input id="dayInput" type="number" placeholder="Day" class="border px-2 py-1 w-24">
        <button onclick="searchDate()" class="bg-blue-600 text-white px-3 py-1 rounded">Search</button>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar" id="calendar"></div>

</div>

<script>
    // Enable Enter key for search inputs
    document.getElementById("dateSearchBar")?.addEventListener("keydown", function(e) {
        if (e.key === "Enter") searchDate();
    });

    let highlightDay = null;

    function loadCalendar(year = null, month = null) {
        let url = '/api/month';
        if (year && month) url += `?year=${year}&month=${month}`;

        fetch(url)
            .then(async res => {
                if (!res.ok) {
                    const errorMessage = await res.text();
                    alert(errorMessage);
                    return null;
                }
                return res.json();
            })
            .then(data => {
                if (!data) return;

                const calendar = document.getElementById('calendar');
                const title = document.getElementById('title');

                calendar.innerHTML = "";

                const { year, month, daysInMonth, startDayOfWeek } = data;

                const monthNames = [
                    "January","February","March","April","May","June",
                    "July","August","September","October","November","December"
                ];

                title.innerText = `${monthNames[month - 1]} ${year}`;

                // Day titles
                ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"].forEach(d => {
                    const div = document.createElement("div");
                    div.className = "day-title";
                    div.innerText = d;
                    calendar.appendChild(div);
                });

                // Empty slots
                for (let i = 1; i < startDayOfWeek; i++) {
                    let empty = document.createElement("div");
                    empty.className = "empty";
                    calendar.appendChild(empty);
                }

                // Days
                for (let d = 1; d <= daysInMonth; d++) {
                    const div = document.createElement("div");
                    div.className = "day";
                    div.innerText = d;

                    if (highlightDay === d) div.classList.add("highlight");

                    calendar.appendChild(div);
                }
            })
            .catch(err => {
                console.error("Error:", err);
                alert("Unexpected error occurred.");
            });
    }


    function searchDate() {
        const year = document.getElementById("yearInput").value;
        const month = document.getElementById("monthInput").value;
        const day = document.getElementById("dayInput").value;

        if (!year || !month || !day) {
            alert("Enter year, month and day!");
            return;
        }

        fetch(`/api/findDate?year=${year}&month=${month}&day=${day}`)
            .then(async res => {
            if (!res.ok) {
                const errorMessage = await res.text();
                alert(errorMessage);
                return null;
            }
            return res.json();
            })
            .then(data => {
                if (!data) return;

                highlightDay = data.day;
                loadCalendar(data.year, data.month);
            })
            .catch(err => {
                console.error("Error:", err);
                alert("Unexpected error occurred.");
            });
    }

    loadCalendar(); // Initial render

     // for sidebar toggle
    const sidebar = document.getElementById('sidebar');
    const openBtn = document.getElementById('openSidebar');
    const closeBtn = document.getElementById('closeSidebar');

    openBtn.addEventListener('click', () => {
        sidebar.classList.remove('-translate-x-full');
    });

    closeBtn.addEventListener('click', () => {
        sidebar.classList.add('-translate-x-full');
    });

</script>


</body>
</html>
